## 250710  
- 이미지+텍스트 멀티모달 응답 기능 추가, 수신 정상 확인 
- 기존 gemini 공식 문서참조 시 에러-> OpenAI 라이브러리의 멀티모달 메시지 구조를 적용
- 1. 실패 요인 요약
- 이미지 첨부 시, REST API 방식(직접 HTTP POST)으로만 시도 → 계속 실패(404, 구조 불일치, 권한 등)
- OpenAI 라이브러리 방식도 시도했으나, 메시지 구조가 잘못되어 타입 에러 발생
- 2. 성공 요인
- OpenAI 라이브러리(chat.completions.create)에서 멀티모달 메시지 구조를 공식 문서대로 정확히 맞춤
- content 에 리스트 형태로 { "type": "text", ... } { "type": "image_url", "image_url": { "url": ... } } 이 구조가 맞아야 Gemini가 이미지를 인식하고 멀티모달 답변을 반환함
- 3. 부가적 요인
- 이미지 경로의 한글/특수문자 문제를 unquote로 해결
- 파일 존재 여부 체크 및 예외처리 강화
- REST API 방식은 백업으로만 남김

- Railway 서버 구동 (url : https://hearthchat-production.up.railway.app)
- 서버 구동 과정에서 오류 : 
- 1. 핵심 원인: Railway의 PORT 환경변수 미사용
- Railway 같은 PaaS(Platform as a Service)에서는 컨테이너가 리스닝해야 하는 포트 번호를 PORT 환경변수로 지정해서 전달
- 기존 Dockerfile에서는 Daphne를 항상 8000번 포트로만 실행
- 하지만 Railway는 내부적으로 임의의 포트(예: 5234 등)를 할당하고, PORT 환경변수로 그 값을 컨테이너에 전달
- 만약 Daphne가 이 PORT 환경변수를 사용하지 않고 8000번 포트만 리스닝하면, Railway의 헬스체크가 해당 포트에 접근하지 못해 컨테이너를 "비정상"으로 간주하고 바로 종료 -> 서버가 구동과 동시에 종료된 원인
- 2. 해결 방법: PORT 환경변수 사용
- Dockerfile의 CMD를 $ 로 수정해서, PORT 환경변수가 있으면 그 포트로, 없으면 8000번 포트로 리스닝하도록 변경
- 이 변경으로 Railway가 할당한 포트로 Daphne가 정상적으로 리스닝, 헬스체크가 통과되어 컨테이너가 정상적으로 실행
- 3. 기타 원인 후보와 점검
- ALLOWED_HOSTS, DB 연결, asgi.py import 등도 모두 점검했으나, 가장 결정적인 원인은 "PORT 환경변수 미사용"
- 실제로 asgi.py의 print문, try/except, DB를 SQLite로 바꾸는 등 다양한 실험을 했지만,
PORT 환경변수 문제를 해결하자마자 바로 OK가 떴음
- 4. Railway, Heroku, Render 등 PaaS에서의 공통 패턴: 이런 플랫폼들은 항상 PORT 환경변수를 사용해서 컨테이너가 리스닝할 포트를 지정  
- Flask, Django, Node.js 등 어떤 서버든 반드시 PORT 환경변수를 사용해야 정상적으로 외부에서 접근할 수 있음
- 요약:서버가 제대로 실행되지 않던 진짜 이유 - Railway가 할당한 포트(PORT 환경변수)로 Daphne가 리스닝하지 않아서, 헬스체크가 실패하고 컨테이너가 바로 종료된 것
- 해결:Dockerfile에서 PORT 환경변수를 사용하도록 Daphne 실행 명령을 수정
- 고찰:이제 이 패턴을 기억해두면, 다른 PaaS(예: Heroku, Render, Vercel 등)에서도 비슷한 문제를 빠르게 해결할 수 있을 듯